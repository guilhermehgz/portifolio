<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2048 - Jogo de Fusão</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #0d0d0d;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
  }
  h1 {
    color: #2196f3;
    margin-bottom: 10px;
  }
  #game {
    background: #222;
    border-radius: 10px;
    padding: 15px;
    display: grid;
    grid-template-columns: repeat(4, 80px);
    grid-template-rows: repeat(4, 80px);
    gap: 12px;
    user-select: none;
  }
  .tile {
    width: 80px;
    height: 80px;
    background: #333;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 700;
    font-size: 2rem;
    color: #eee;
    transition: background 0.3s ease, color 0.3s ease;
  }
  /* Cores diferentes para valores diferentes */
  .tile-2 { background: #eee4da; color: #776e65; }
  .tile-4 { background: #ede0c8; color: #776e65; }
  .tile-8 { background: #f2b179; color: #f9f6f2; }
  .tile-16 { background: #f59563; color: #f9f6f2; }
  .tile-32 { background: #f67c5f; color: #f9f6f2; }
  .tile-64 { background: #f65e3b; color: #f9f6f2; }
  .tile-128 { background: #edcf72; color: #f9f6f2; font-size: 1.8rem; }
  .tile-256 { background: #edcc61; color: #f9f6f2; font-size: 1.8rem; }
  .tile-512 { background: #edc850; color: #f9f6f2; font-size: 1.8rem; }
  .tile-1024 { background: #edc53f; color: #f9f6f2; font-size: 1.6rem; }
  .tile-2048 { background: #edc22e; color: #f9f6f2; font-size: 1.6rem; }

  #scoreboard {
    margin-top: 15px;
    font-size: 1.2rem;
    color: #00e676;
  }

  #message {
    margin-top: 15px;
    font-size: 1.3rem;
    color: #ff5252;
  }
  button {
  background-color: #4CAF50; /* Verde */
  color: white;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

button:hover {
  background-color: #45a049; /* Verde mais escuro no hover */
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

button:active {
  transform: translateY(0);
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}

</style>
</head>
<body>

<h1>2048 - Jogo de Fusão</h1>



<div id="game"></div>
<div id="scoreboard">Pontuação: 0</div>
<div id="message"></div>

<div> 
  <a href="../ggames.html">
  <button>Voltar à Página Inicial</button>
</a>

</div>

<script>
// === Variáveis do jogo ===
const size = 4; // tabuleiro 4x4
let board = []; // matriz 2D para guardar os números
let score = 0;
const gameContainer = document.getElementById("game");
const scoreDisplay = document.getElementById("scoreboard");
const messageDisplay = document.getElementById("message");

// === Inicializa o tabuleiro com zeros (casas vazias) ===
function initBoard() {
  board = [];
  for (let i = 0; i < size; i++) {
    board.push(new Array(size).fill(0));
  }
}

// === Adiciona um novo número (2 ou 4) em uma casa vazia aleatória ===
function addRandomTile() {
  let emptyCells = [];
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
      if (board[i][j] === 0) emptyCells.push({ x: i, y: j });
    }
  }
  if (emptyCells.length === 0) return false; // sem espaço

  // Escolhe uma posição aleatória
  const pos = emptyCells[Math.floor(Math.random() * emptyCells.length)];
  // 90% chance de 2, 10% chance de 4
  board[pos.x][pos.y] = Math.random() < 0.9 ? 2 : 4;
  return true;
}

// === Desenha o tabuleiro no DOM ===
function drawBoard() {
  gameContainer.innerHTML = "";
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
      const val = board[i][j];
      const tile = document.createElement("div");
      tile.classList.add("tile");
      if (val !== 0) tile.classList.add("tile-" + val);
      tile.textContent = val === 0 ? "" : val;
      gameContainer.appendChild(tile);
    }
  }
  scoreDisplay.textContent = "Pontuação: " + score;
}

// === Move e funde uma linha ou coluna para esquerda, retorna linha fundida e score ganho ===
function slideAndCombine(line) {
  // Remove zeros
  let arr = line.filter(val => val !== 0);

  // Junta números iguais consecutivos
  for (let i = 0; i < arr.length - 1; i++) {
    if (arr[i] === arr[i + 1]) {
      arr[i] *= 2;
      score += arr[i]; // soma score
      arr[i + 1] = 0; // elimina o próximo pois já fundiu
    }
  }

  // Remove zeros criados após fusão
  arr = arr.filter(val => val !== 0);

  // Preenche com zeros até o tamanho original
  while (arr.length < size) {
    arr.push(0);
  }

  return arr;
}

// === Movimentos do jogo ===
function moveLeft() {
  let moved = false;
  for (let i = 0; i < size; i++) {
    const original = [...board[i]];
    const newLine = slideAndCombine(board[i]);
    board[i] = newLine;
    if (!arraysEqual(original, newLine)) moved = true;
  }
  return moved;
}

function moveRight() {
  let moved = false;
  for (let i = 0; i < size; i++) {
    const original = [...board[i]];
    let reversed = [...board[i]].reverse();
    let newLine = slideAndCombine(reversed);
    newLine.reverse();
    board[i] = newLine;
    if (!arraysEqual(original, newLine)) moved = true;
  }
  return moved;
}

function moveUp() {
  let moved = false;
  for (let col = 0; col < size; col++) {
    let column = [];
    for (let row = 0; row < size; row++) {
      column.push(board[row][col]);
    }
    const original = [...column];
    const newCol = slideAndCombine(column);
    for (let row = 0; row < size; row++) {
      board[row][col] = newCol[row];
    }
    if (!arraysEqual(original, newCol)) moved = true;
  }
  return moved;
}

function moveDown() {
  let moved = false;
  for (let col = 0; col < size; col++) {
    let column = [];
    for (let row = 0; row < size; row++) {
      column.push(board[row][col]);
    }
    const original = [...column];
    let reversed = column.reverse();
    let newCol = slideAndCombine(reversed);
    newCol.reverse();
    for (let row = 0; row < size; row++) {
      board[row][col] = newCol[row];
    }
    if (!arraysEqual(original, newCol)) moved = true;
  }
  return moved;
}

// === Verifica se o jogo acabou ===
function isGameOver() {
  // Se existe algum zero, jogo continua
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size; j++) {
      if (board[i][j] === 0) return false;
    }
  }
  // Se pode mover em qualquer direção, jogo continua
  if (canMove()) return false;
  return true;
}

// === Verifica se pode mover para alguma direção ===
function canMove() {
  // Tenta simular movimentos e verificar se algum mudaria o tabuleiro
  if (canMoveLeft() || canMoveRight() || canMoveUp() || canMoveDown()) return true;
  return false;
}

function canMoveLeft() {
  for (let i = 0; i < size; i++) {
    for (let j = 1; j < size; j++) {
      if (board[i][j] !== 0 &&
        (board[i][j-1] === 0 || board[i][j-1] === board[i][j])) {
        return true;
      }
    }
  }
  return false;
}

function canMoveRight() {
  for (let i = 0; i < size; i++) {
    for (let j = 0; j < size -1; j++) {
      if (board[i][j] !== 0 &&
        (board[i][j+1] === 0 || board[i][j+1] === board[i][j])) {
        return true;
      }
    }
  }
  return false;
}

function canMoveUp() {
  for (let j = 0; j < size; j++) {
    for (let i = 1; i < size; i++) {
      if (board[i][j] !== 0 &&
        (board[i-1][j] === 0 || board[i-1][j] === board[i][j])) {
        return true;
      }
    }
  }
  return false;
}

function canMoveDown() {
  for (let j = 0; j < size; j++) {
    for (let i = 0; i < size -1; i++) {
      if (board[i][j] !== 0 &&
        (board[i+1][j] === 0 || board[i+1][j] === board[i][j])) {
        return true;
      }
    }
  }
  return false;
}

// === Função utilitária para comparar arrays ===
function arraysEqual(a, b) {
  if (a.length !== b.length) return false;
  for(let i=0; i<a.length; i++) {
    if (a[i] !== b[i]) return false;
  }
  return true;
}

// === Função principal que executa o movimento conforme tecla pressionada ===
function handleKey(e) {
  let moved = false;
  switch (e.key) {
    case "ArrowLeft":
      moved = moveLeft();
      break;
    case "ArrowRight":
      moved = moveRight();
      break;
    case "ArrowUp":
      moved = moveUp();
      break;
    case "ArrowDown":
      moved = moveDown();
      break;
    default:
      return; // ignora outras teclas
  }
  if (moved) {
    addRandomTile(); // adiciona nova peça
    drawBoard();     // redesenha tabuleiro
    if (isGameOver()) {
      messageDisplay.textContent = "Fim de jogo! Pressione F5 para jogar novamente.";
      document.removeEventListener("keydown", handleKey);
    }
  }
}

// === Inicialização do jogo ===
function startGame() {
  initBoard();
  addRandomTile();
  addRandomTile();
  drawBoard();
  score = 0;
  scoreDisplay.textContent = "Pontuação: 0";
  messageDisplay.textContent = "";
  document.addEventListener("keydown", handleKey);
}

startGame();
</script>

</body>
</html>
