<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flappy Bird - Hub</title>
<style>
  :root{
    --bg:#0d0d0d;
    --panel:#1a1a1a;
    --accent:#2196f3;
    --accent2:#00e676;
    --danger:#ff5252;
    --card-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }
  html,body{height:100%;margin:0;font-family:'Segoe UI',Tahoma,Arial,sans-serif;background:var(--bg);color:#eee;display:flex;align-items:center;justify-content:center;padding:18px;}
  .container{max-width:1000px;width:100%;display:grid;grid-template-columns:1fr 1fr;gap:28px;align-items:start;}
  h1{grid-column:span 2;text-align:center;color:var(--accent);margin:0 0 8px;font-size:1.9rem;}
  .painel{background:var(--panel);padding:18px;border-radius:10px;box-shadow:var(--card-shadow);display:flex;flex-direction:column;gap:10px;}
  label{font-size:0.95rem;color:#ccc;}
  select, button{font-size:1rem;padding:10px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer;transition:background .18s;}
  select:hover, button:hover{background:#1976d2;}
  #scoreBox{font-weight:700;color:var(--accent2);font-size:1.15rem;margin-top:6px;}
  canvas{width:100%;height:auto;display:block;border-radius:10px;border:2px solid var(--accent);background:#0f1112;box-shadow:var(--card-shadow);}
  .controls-mobile{display:none;margin-top:12px;gap:8px;justify-content:center;}
  .controls-mobile button{width:60px;height:60px;border-radius:8px;font-size:1.4rem;padding:0;}
  .meta{font-size:0.9rem;color:#bbb;}
  .small-btn{background:#333;color:#fff;padding:8px;border-radius:8px;}
  @media (max-width:768px){
    .container{grid-template-columns:1fr;}
    .controls-mobile{display:flex;}
  }
</style>
</head>
<body>
<div class="container">
  <h1>Flappy Bird — Hub</h1>

  <!-- Painel lateral / configuração -->
  <div class="painel">
    <label for="dificuldade">Dificuldade (gap entre canos):</label>
    <select id="dificuldade">
      <option value="140">Fácil (gap grande)</option>
      <option value="120" selected>Médio</option>
      <option value="100">Difícil (gap menor)</option>
      <option value="85">Brutal</option>
    </select>

    <label for="velocidade">Velocidade dos canos (maior = mais rápido):</label>
    <select id="velocidade">
      <option value="2">Lento</option>
      <option value="3" selected>Padrão</option>
      <option value="4">Rápido</option>
      <option value="5">Insano</option>
    </select>

    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button id="startBtn">Iniciar</button>
      <button id="pauseBtn" class="small-btn">Pausar</button>
      <button id="restartBtn" class="small-btn">Reiniciar</button>
      <a href="../ggames.html">
  <button class="small-btn">Voltar</button></a>
    </div>

    <div id="scoreBox">Pontos: 0</div>
    <div class="meta">Recorde: <span id="highscore">0</span></div>
    <div class="meta">Controles: Espaço / Clique / Toque</div>

    <!-- Controles mobile visíveis em tela pequena -->
    <div class="controls-mobile">
      <button onclick="flap()" aria-label="Subir">⬆️</button>
      <button onclick="pauseToggle()" class="small-btn">⏯</button>
      <button onclick="restart()" class="small-btn">↻</button>
    </div>
  </div>

  <!-- Canvas do jogo -->
  <div>
    <canvas id="game" width="480" height="640"></canvas>
    <div class="painel" style="margin-top:12px;">
      <div class="meta">Toque na tela ou pressione Espaço para bater as asas.</div>
      <div class="meta">Evite os canos. Pontue a cada cano ultrapassado.</div>
    </div>
  </div>
</div>

<script>
/* === Setup === */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = canvas.width, H = canvas.height;

const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const restartBtn = document.getElementById('restartBtn');
const scoreBox = document.getElementById('scoreBox');
const highscoreEl = document.getElementById('highscore');
const gapSelect = document.getElementById('dificuldade');
const speedSelect = document.getElementById('velocidade');

let gameTimer = null;
let running = false;
let paused = false;

/* === Estado do jogo === */
let bird, pipes, gravity, flapPower, pipeGap, pipeSpeed, frameCount, score, highscore;

/* === Inicializar variáveis padrão === */
function resetState(){
  bird = { x: 100, y: H/2, w:34, h:24, vy:0, rotation:0 };
  pipes = [];
  gravity = 0.30;
  flapPower = -4.5;
  pipeGap = parseInt(gapSelect.value); // gap vertical
  pipeSpeed = parseFloat(speedSelect.value);
  frameCount = 0;
  score = 0;
  highscore = parseInt(localStorage.getItem('flappy_high') || '0');
  highscoreEl.textContent = highscore;
  scoreBox.textContent = `Pontos: ${score}`;
}

/* === Funções de jogo === */
function spawnPipe(){
  // posição do topo do gap (entre 60 e H - 60 - gap)
  const margin = 60;
  const top = Math.floor(Math.random() * (H - pipeGap - margin*2)) + margin;
  pipes.push({ x: W + 20, top: top, passed: false });
}

function flap(){
  if(!running) return;
  bird.vy = flapPower;
  bird.rotation = -0.2;
}

function start(){
  if(running){ return; }
  resetState();
  running = true;
  paused = false;
  pauseBtn.textContent = 'Pausar';
  // spawner + game loop via setInterval simples
  gameTimer = setInterval(loop, 1000/60);
}

function pauseToggle(){
  if(!running) return;
  paused = !paused;
  pauseBtn.textContent = paused ? 'Continuar' : 'Pausar';
}

function restart(){
  clearInterval(gameTimer);
  running = false;
  start();
}

/* colisões AABB simples */
function collided(b, pipe){
  // pipe top rect
  if (b.x + b.w > pipe.x && b.x < pipe.x + 52) {
    if (b.y < pipe.top || b.y + b.h > pipe.top + pipeGap) {
      return true;
    }
  }
  return false;
}

function gameOver(){
  clearInterval(gameTimer);
  running = false;
  paused = false;
  // atualiza recorde
  if(score > highscore){
    localStorage.setItem('flappy_high', score);
    highscore = score;
    highscoreEl.textContent = highscore;
  }
  setTimeout(()=>{ alert(`Game Over! Pontos: ${score}`); }, 50);
}

/* === Loop principal === */
function loop(){
  if(paused) return;
  update();
  render();
}

/* Atualiza física e lógica */
function update(){
  frameCount++;
  // física do pássaro
  bird.vy += gravity;
  bird.y += bird.vy;
  bird.rotation += 0.03;
  if (bird.rotation > 1.2) bird.rotation = 1.2;

  // spawn pipes a cada ~90 frames (1.5s a 60fps)
  if(frameCount % Math.max(45, Math.floor(120 - pipeSpeed*8)) === 0){
    spawnPipe();
  }

  // mover canos
  for(let i = pipes.length-1; i>=0; i--){
    pipes[i].x -= pipeSpeed;
    // marcar ponto quando passa o bird
    if(!pipes[i].passed && pipes[i].x + 52 < bird.x){
      pipes[i].passed = true;
      score++;
      scoreBox.textContent = `Pontos: ${score}`;
    }
    // remover cano fora da tela
    if(pipes[i].x < -80) pipes.splice(i,1);
  }

  // colisões com chão/ceiling
  if(bird.y + bird.h >= H || bird.y <= 0){
    gameOver();
    return;
  }

  // colisões com canos
  for(let p of pipes){
    if(collided(bird, p)){ gameOver(); return; }
  }
}

/* Renderiza tudo */
function render(){
  // background
  ctx.fillStyle = '#0f1112';
  ctx.fillRect(0,0,W,H);

  // desenhar pipes
  for(let p of pipes){
    // tubo topo
    ctx.fillStyle = '#2e7d32'; // verde escuro
    ctx.fillRect(p.x, 0, 35, p.top);
    // tubo inferior
    ctx.fillRect(p.x, p.top + pipeGap, 52, H - (p.top + pipeGap));
    // bordas
    ctx.strokeStyle = '#184d1a';
    ctx.strokeRect(p.x, 0, 52, p.top);
    ctx.strokeRect(p.x, p.top + pipeGap, 52, H - (p.top + pipeGap));
  }

  // desenhar pássaro (simples)
  ctx.save();
  ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
  ctx.rotate(bird.rotation);
  ctx.fillStyle = '#ffb300';
  ctx.fillRect(-bird.w/2, -bird.h/2, bird.w, bird.h);
  // olho
  ctx.fillStyle = '#fff';
  ctx.fillRect(6, -6, 6, 6);
  ctx.fillStyle = '#000';
  ctx.fillRect(8, -4, 2, 2);
  ctx.restore();

  // UI: score central pequeno
  ctx.fillStyle = 'rgba(255,255,255,0.06)';
  ctx.fillRect(W/2 - 40, 10, 80, 34);
  ctx.fillStyle = '#00e676';
  ctx.font = '10px Segoe UI, Arial';
  ctx.textAlign = 'center';
  ctx.fillText(score, W/2, 32);
}

/* === Eventos de controle === */
canvas.addEventListener('click', () => {
  if(!running) start();
  flap();
});
document.addEventListener('keydown', (e) => {
  if(e.code === 'Space'){
    e.preventDefault();
    if(!running) start();
    flap();
  } else if(e.code === 'KeyP'){
    pauseToggle();
  } else if(e.code === 'KeyR'){
    restart();
  }
});
document.getElementById('startBtn').addEventListener('click', () => {
  if(!running) start();
});
document.getElementById('pauseBtn').addEventListener('click', pauseToggle);
document.getElementById('restartBtn').addEventListener('click', () => {
  restart();
});
gapSelect.addEventListener('change', ()=>{ pipeGap = parseInt(gapSelect.value); });
speedSelect.addEventListener('change', ()=>{ pipeSpeed = parseFloat(speedSelect.value); });

/* toque mobile (sustenta para não disparar gesto de scroll) */
let touchStartY = null;
canvas.addEventListener('touchstart', (e)=>{
  e.preventDefault();
  if(!running) start();
  flap();
}, {passive:false});

/* ajuste de canvas para retina / responsivo */
function resizeCanvas(){
  // manter proporção original mas desenhar em resolução fixa
  // aqui mantemos canvas lógico em 480x640 e apenas escalamos via CSS (já configurado)
  const ratio = window.devicePixelRatio || 1;
  canvas.width = 480 * ratio;
  canvas.height = 640 * ratio;
  canvas.style.width = '100%';
  canvas.style.height = 'auto';
  ctx.setTransform(ratio,0,0,ratio,0,0);
  W = canvas.width / ratio;
  H = canvas.height / ratio;
  // ajustar posição do bird caso necessário
  if(bird) bird.y = Math.min(bird.y, H - bird.h - 2);
}
window.addEventListener('resize', resizeCanvas);

/* Start inicial */
resetState();
resizeCanvas();
render();
</script>
</body>
</html>
